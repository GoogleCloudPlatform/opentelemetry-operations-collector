# NOTE: File generated by distrogen. Do not manually edit.

# This Dockerfile provides the same resulting container as
# the main Dockerfile, but it also performs the build within
# an earlier layer. The resulting container will be scratch and
# should be functionally identical.

# By default, this container should have the root of your project
# where all distributions are container. The generated version will
# use the respective distribution as the working directory for builds.
# The whole project is copied to the container in case you provide
# any custom components contained within your full project structure.
ARG PROJECT_ROOT="."
# Currently, this container has to be alpine based.
{{ if eq .BuildContainer "debian" -}}
ARG BUILD_CONTAINER="debian"
FROM ${BUILD_CONTAINER} AS build

RUN apt-get update && apt-get install -y make curl git{{ if .CollectorCGO }} build-essential{{ end }}

{{ else -}}
ARG BUILD_CONTAINER="alpine"
FROM ${BUILD_CONTAINER} AS build

RUN apk --update add make curl git{{ if .CollectorCGO }} alpine-sdk{{ end }}

{{ end -}}

ARG PROJECT_ROOT
COPY ${PROJECT_ROOT} /

WORKDIR /{{ .Name }}
RUN make goreleaser-release
